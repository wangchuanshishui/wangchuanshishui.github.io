---
layout: post
title: 栈与堆的区别
categories: [C, 内存管理]
description: 栈与堆的区别-转载
keywords: C, 内存管理
typora-root-url: ..
---

# 堆和栈的区别

这篇文章网上到处都是转载，很多是一些不用心的直接复制粘贴，格式排版一点都不注意，观看时特别难受，所以我重新排版了一下，原作者已不知。希望对你有所帮助。

### 1:管理方式不同

 　　管理方式：对于栈来讲，是由**编译器自动管理**，无需我们手工控制；对于堆来说，释放工作由**程序员控制**，容易产生memory leak。

### 2:空间大小不同

   	空间大小：一般来讲在32位系统下，堆内存可以达到4G的空间，从这个角度来看堆内存几乎是没有什么限制的。但是对于栈来讲，一般都是有一定的空间大小的，例如，在VC6下面，默认的栈空间大小是1M。当然，我们可以修改： 打开工程，依次操作菜单如下：Project->Setting->Link，在Category 中选中Output，然后在Reserve中设定堆栈的最大值和commit。

### 3:能否产生碎片不同

　　碎片问题：对于堆来讲，频繁的new/delete势必会造成**内存空间的不连续**，从而造成大量的碎片，使程序效率降低。对于栈来讲，则不会存在这个问题，因为栈是先进后出的队列，他们是如此的一一对应，以至于永远都不可能有一个内存块从栈中间弹出，在他弹出之前，在他上面的后进的栈内容已经被弹出。

### 4:生长方向不同

　　生长方向：对于堆来讲，生长方向是向上的，也就是向着内存地址增加的方向；对于栈来讲，它的生长方向是向下的，是向着内存地址减小的方向增长。

### 5:分配方式不同

​	分配方式：**堆都是动态分配的**，没有静态分配的堆。栈有2种分配方式：静态分配和动态分配。静态分配是编译器完成的，比如局部变量的分配。动态分配由alloca函数进行分配，但是栈的动态分配和堆是不同的，他的动态分配是**由编译器进行释放，无需我们手工实现**。

### 6:分配效率不同

​	分配效率：栈是机器系统提供的数据结构，计算机会在底层对栈提供支持：分配专门的寄存器存放栈的地址，压栈出栈都有专门的指令执行，这就决定了栈的效率比较高。堆则是C/C++函数库提供的，它的机制是很复杂的，例如为了分配一块内存，库函数会按照一定的算法（具体的算法可以参考数据结构/操作系统）在堆内存中搜索可用的足够大小的空间，如果没有足够大小的空间（可能是由于内存碎片太多），就有可能调用系统功能去增加程序数据段的内存空间，这样就有机会分到足够大小的内存，然后进行返回。显然，堆的效率比栈要低得多。

